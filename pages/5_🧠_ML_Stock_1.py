# pages/5_üß†_ML_Stock_1.py
import streamlit as st

st.set_page_config(page_title="Conclusion ‚Ä¢ Stock Buy Prediction", page_icon="‚úÖ", layout="wide")

# -----------------------------
# ‡∏™‡∏£‡∏∏‡∏õ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏°‡πÑ‡∏ü‡∏•‡πå PDF)
# -----------------------------
st.title("‡∏™‡∏£‡∏∏‡∏õ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (Conclusion) ‚úÖ")
st.caption("ML Project: Stock Buy Prediction ‚Äî ‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ö‡∏ö‡∏¢‡πà‡∏≠ ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏™‡∏£‡∏∏‡∏õ")

st.header("1) ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå (Overview)")
st.markdown(
    """
‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏ö **Machine Learning** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö **‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á‡∏´‡∏∏‡πâ‡∏ô‡πÑ‡∏ó‡∏¢** ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ **‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô (Fundamental Factors)** 
‡πÄ‡∏ä‡πà‡∏ô **ROE, Debt-to-Equity, Margin, OCF/CL** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏ß‡πà‡∏≤ **‡∏´‡∏∏‡πâ‡∏ô‡∏ô‡∏±‡πâ‡∏ô‡∏°‡∏µ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏° ‚Äú‡∏ô‡πà‡∏≤‡∏ã‡∏∑‡πâ‡∏≠‚Äù ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏ô‡∏≠‡∏µ‡∏Å 6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤**  

**‡πÇ‡∏Ñ‡∏£‡∏á‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° (Flow):**  
- **Input:** ‡∏á‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™/‡∏£‡∏≤‡∏¢‡∏õ‡∏µ ‚Üí ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÅ‡∏ö‡∏ö TTM  
- **Model:** ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô 10 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‚Üí ‡πÄ‡∏ó‡∏£‡∏ô‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏ú‡∏•  
- **Output:** ‡∏ú‡∏• ‚Äú‡∏ô‡πà‡∏≤‡∏ã‡∏∑‡πâ‡∏≠ / ‡πÑ‡∏°‡πà‡∏ô‡πà‡∏≤‡∏ã‡∏∑‡πâ‡∏≠‚Äù ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ
"""
)

st.header("2) ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (‡∏à‡∏≤‡∏Å Auto_Fundamental_fixed_v7.py)")
st.subheader("üîπ Section 1: ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Dataset")
st.code(
    """def build_dataset():
    for tk in TICKERS:
        t = yf.Ticker(tk + ".BK")
        price_hist = t.history(period="max")
        price = price_hist.get("Close")
        q_rows = extract_samples_quarterly(t, price)""",
    language="python",
)
st.markdown(
    """
**‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢:** ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Yahoo Finance ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏∏‡πâ‡∏ô‡πÑ‡∏ó‡∏¢‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î (ROE, Margin, ‡∏Ø‡∏•‡∏Ø) ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö **TTM**  
‡∏´‡∏≤‡∏Å‡∏á‡∏ö‡∏£‡∏≤‡∏¢‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™‡πÑ‡∏°‡πà‡∏û‡∏≠ ‡∏à‡∏∞‡∏ñ‡∏≠‡∏¢‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏á‡∏ö‡∏£‡∏≤‡∏¢‡∏õ‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå
"""
)

st.subheader("üîπ Section 2: ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Feature ‡πÅ‡∏•‡∏∞ Target")
st.code('df["target"] = (df["forward_6m_return"] > 0).astype(int)', language="python")
st.markdown(
    """
**‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢:**  
- `target = 1` ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏´‡∏∏‡πâ‡∏ô **‡∏°‡∏µ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Ç‡∏∂‡πâ‡∏ô** ‡πÉ‡∏ô‡∏≠‡∏µ‡∏Å 6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô  
- `target = 0` ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á **‡πÑ‡∏°‡πà‡∏Ç‡∏∂‡πâ‡∏ô** (‡∏•‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏£‡∏á‡∏ï‡∏±‡∏ß)
"""
)

st.subheader("üîπ Section 3: ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Pipeline ‡πÅ‡∏•‡∏∞‡πÄ‡∏ó‡∏£‡∏ô‡πÇ‡∏°‡πÄ‡∏î‡∏•")
st.code(
    """pipe = Pipeline([
    ("imputer", SimpleImputer(strategy="median")),
    ("rf", RandomForestClassifier(
        n_estimators=400, max_depth=6, min_samples_leaf=5,
        random_state=42, class_weight="balanced_subsample"
    ))
])
pipe.fit(X_train, y_train)""",
    language="python",
)
st.markdown(
    """
**‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢:** ‡πÉ‡∏ä‡πâ **RandomForestClassifier** ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ä‡∏¥‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏´‡∏•‡∏≤‡∏¢‡∏°‡∏¥‡∏ï‡∏¥ ‡πÅ‡∏•‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡∏•‡∏î‡πÇ‡∏≠‡∏Å‡∏≤‡∏™ **overfitting**
"""
)

st.subheader("üîπ Section 4: ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö Threshold ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°")
st.code(
    """thr, best_f1 = tune_threshold(y_test, y_prob)
print(f"Best threshold by F1: {thr:.3f}")""",
    language="python",
)
st.markdown("**‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢:** ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à (threshold) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏° **F1-Score** ‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏î‡∏∏‡∏•‡∏ó‡∏±‡πâ‡∏á Precision/Recall")

st.subheader("üîπ Section 5: Export & Result")
st.code(
    """dump(pipe, "buy_model_pipeline.pkl")        # ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏°‡πÄ‡∏î‡∏•
out.to_csv("predictions_latest.csv", index=False)  # ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î""",
    language="python",
)
st.markdown("**‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢:** ‡πÑ‡∏î‡πâ‡πÑ‡∏ü‡∏•‡πå‡πÇ‡∏°‡πÄ‡∏î‡∏• `.pkl` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠ ‡πÅ‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå‡∏ú‡∏•‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡πÑ‡∏õ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•/‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô")

st.header("3) ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ (Outputs)")
st.markdown(
    """
- **dataset_financials_ttm.csv** ‚Äî ‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• TTM ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏°‡πÄ‡∏î‡∏•  
- **feature_importance.csv** ‚Äî ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå (‡πÉ‡∏ä‡πâ‡∏ï‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏°‡πÄ‡∏î‡∏•)  
- **predictions_latest.csv** ‚Äî ‡∏ú‡∏•‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ï‡πà‡∏≠‡∏´‡∏∏‡πâ‡∏ô (Prob. ‡∏ô‡πà‡∏≤‡∏ã‡∏∑‡πâ‡∏≠ + ‡∏õ‡πâ‡∏≤‡∏¢‡∏Å‡∏≥‡∏Å‡∏±‡∏ö)
"""
)

st.header("4) ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô‡πÅ‡∏•‡∏∞ Deployment")
st.code("pip install -r requirements.txt", language="bash")
st.code("streamlit run app.py", language="bash")

st.header("5) ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠ (Conclusion Slide)")
st.markdown(
    """
- ‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å **Yahoo Finance**  
- ‚úÖ ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå **‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô 10 ‡∏ï‡∏±‡∏ß**  
- ‚úÖ ‡πÉ‡∏ä‡πâ **Random Forest** ‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏ß‡πà‡∏≤ ‚Äú‡∏´‡∏∏‡πâ‡∏ô‡∏ô‡πà‡∏≤‡∏ã‡∏∑‡πâ‡∏≠‚Äù  
- ‚úÖ **Export** ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå  
- üöÄ **‡∏ï‡πà‡∏≠‡∏¢‡∏≠‡∏î‡πÑ‡∏î‡πâ:** Dashboard ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏• / ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (Alert)
"""
)

st.caption("‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö ‚Äò‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πâ‡∏ß‡∏ô‚Äô ‡∏ï‡∏≤‡∏°‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏™‡∏£‡∏∏‡∏õ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡∏ô‡∏ï‡πå‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ")
